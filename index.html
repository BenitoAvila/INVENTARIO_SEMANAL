<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Inventario Eurofert Cloud</title>

<!-- Firebase compat -->
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-database-compat.js"></script>

<style>
body{font-family:Arial;background:#1e3c72;color:white;padding:20px}
.card{background:#203a43;padding:20px;border-radius:12px;margin-bottom:20px}
input,select,textarea,button{width:100%;padding:8px;margin:6px 0;border-radius:6px;border:none}
button{background:#00c853;color:white;font-weight:bold}
button:hover{background:#00a843}
h3{margin-top:0}
.registro{background:#1c2b33;padding:8px;margin:5px 0;border-radius:8px}
.ok{background:#2e7d32;padding:6px;border-radius:6px}
.error{background:#c62828;padding:6px;border-radius:6px}
</style>
</head>
<body>

<div class="card">
<h2>ğŸ“¦ Inventario Cloud Eurofert</h2>

<input type="text" id="nombre" placeholder="Nombre colaborador">
<input type="text" id="producto" placeholder="Producto">
<input type="number" id="sistema" placeholder="Cantidad Sistema">
<input type="number" id="fisico" placeholder="FÃ­sico buen estado">
<input type="number" id="muestras" placeholder="Muestras / Promociones">
<input type="number" id="caducados" placeholder="Caducados">
<textarea id="comentarios" placeholder="Comentarios"></textarea>

<div id="estado"></div>

<button onclick="guardar()">Guardar Inventario</button>
</div>

<div class="card">
<h3>ğŸ“Š Filtro por Mes</h3>
<input type="month" id="mesFiltro">
<button onclick="filtrar()">Ver Registros</button>
<div id="resultado"></div>
</div>

<div class="card">
<h3>ğŸ“… Resumen Mensual AutomÃ¡tico</h3>
<div id="resumen"></div>
</div>

<script>

// ğŸ”¥ TU CONFIGURACIÃ“N REAL
const firebaseConfig = {
    apiKey: "AIzaSyBeg5PzCkaf98mmWiXrr6wpu8v-iWDj0t4",
    authDomain: "inventario-eurofert.firebaseapp.com",
    databaseURL: "https://inventario-eurofert-default-rtdb.firebaseio.com",
    projectId: "inventario-eurofert",
    storageBucket: "inventario-eurofert.firebasestorage.app",
    messagingSenderId: "786796692081",
    appId: "1:786796692081:web:c742cfbd1d23c3347f91d0",
    measurementId: "G-XE274QHMK7"
};

firebase.initializeApp(firebaseConfig);
const db = firebase.database();

function guardar(){

let sistema=parseInt(document.getElementById("sistema").value)||0;
let fisico=parseInt(document.getElementById("fisico").value)||0;
let muestras=parseInt(document.getElementById("muestras").value)||0;
let caducados=parseInt(document.getElementById("caducados").value)||0;

let estado=document.getElementById("estado");
estado.innerHTML="";

if(sistema !== (fisico+muestras+caducados)){
estado.innerHTML='<div class="error">âŒ Inventario no cuadra</div>';
return;
}

let datos={
fecha:new Date().toISOString(),
nombre:document.getElementById("nombre").value,
producto:document.getElementById("producto").value,
sistema:sistema,
fisico:fisico,
muestras:muestras,
caducados:caducados,
comentarios:document.getElementById("comentarios").value
};

db.ref("inventario").push(datos);

estado.innerHTML='<div class="ok">âœ… Guardado correctamente en la nube</div>';

document.getElementById("fisico").value="";
document.getElementById("muestras").value="";
document.getElementById("caducados").value="";
document.getElementById("comentarios").value="";

cargarResumen();
}

function filtrar(){

let mes=document.getElementById("mesFiltro").value;
let resultado=document.getElementById("resultado");
resultado.innerHTML="";

db.ref("inventario").once("value", snapshot=>{
snapshot.forEach(child=>{
let data=child.val();
if(data.fecha.startsWith(mes)){
resultado.innerHTML+=`
<div class="registro">
ğŸ“… ${data.fecha}<br>
ğŸ‘¤ ${data.nombre}<br>
ğŸ“¦ ${data.producto}<br>
Sistema:${data.sistema} | F:${data.fisico} | M:${data.muestras} | C:${data.caducados}
</div>`;
}
});
});
}

function cargarResumen(){

let resumen=document.getElementById("resumen");
resumen.innerHTML="";

let mesActual=new Date().toISOString().slice(0,7);

let totalRegistros=0;

db.ref("inventario").once("value", snapshot=>{
snapshot.forEach(child=>{
let data=child.val();
if(data.fecha.startsWith(mesActual)){
totalRegistros++;
}
});

resumen.innerHTML=`
Total registros del mes actual: <b>${totalRegistros}</b>
`;
});
}

// Cargar resumen al abrir
cargarResumen();

</script>

</body>
</html>