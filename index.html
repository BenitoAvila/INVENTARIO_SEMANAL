<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Login Inventario</title>

<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-database-compat.js"></script>

<style>
body{
font-family:Arial;
background:#1e3c72;
display:flex;
justify-content:center;
align-items:center;
height:100vh;
margin:0;
color:white;
}
.card{
background:#203a43;
padding:30px;
border-radius:12px;
width:350px;
}
input,button{
width:100%;
padding:10px;
margin:8px 0;
border-radius:6px;
border:none;
}
button{
background:#00c853;
color:white;
font-weight:bold;
cursor:pointer;
}
button:hover{
opacity:0.9;
}
#error{
color:#ff5252;
margin-top:5px;
}
</style>
</head>
<body>

<div class="card">
<h2>üîê EUROFERT INVENTARIO</h2>

<input type="text" id="usuario" placeholder="Usuario">
<input type="password" id="password" placeholder="Contrase√±a">

<button onclick="login()">Ingresar</button>

<p id="error"></p>
</div>

<script>

// üî• LIMPIAR SESI√ìN AL CARGAR LOGIN
localStorage.clear();

// üî• CONFIG FIREBASE
const firebaseConfig = {
    apiKey: "AIzaSyBeg5PzCkaf98mmWiXrr6wpu8v-iWDj0t4",
    authDomain: "inventario-eurofert.firebaseapp.com",
    databaseURL: "https://inventario-eurofert-default-rtdb.firebaseio.com",
    projectId: "inventario-eurofert",
    storageBucket: "inventario-eurofert.firebasestorage.app",
    messagingSenderId: "786796692081",
    appId: "1:786796692081:web:c742cfbd1d23c3347f91d0"
};

firebase.initializeApp(firebaseConfig);
const db = firebase.database();

function login(){

let usuario = document.getElementById("usuario").value.trim();
let password = document.getElementById("password").value.trim();
let error = document.getElementById("error");
error.innerText = "";

// üîé Validar campos vac√≠os
if(usuario === "" || password === ""){
error.innerText = "Complete usuario y contrase√±a";
return;
}

// üîé Buscar usuario en Firebase
db.ref("usuarios/" + usuario).once("value")
.then(snapshot => {

if(!snapshot.exists()){
error.innerText = "Usuario no existe";
return;
}

let data = snapshot.val();

if(data.password !== password){
error.innerText = "Contrase√±a incorrecta";
return;
}

// ‚úÖ Guardar sesi√≥n
localStorage.setItem("usuario", usuario);
localStorage.setItem("rol", data.rol);

// üöÄ Redirigir seg√∫n rol
if(data.rol === "admin"){
window.location.href = "admin.html";
}else{
window.location.href = "panel.html";
}

})
.catch(err=>{
error.innerText = "Error de conexi√≥n";
console.error(err);
});

}

</script>

</body>
</html>